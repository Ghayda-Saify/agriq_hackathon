<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriQ | Intelligent Farming</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

    <div class="hero-section text-center">
        <h1><i class="fas fa-seedling"></i> AgriQ Engine</h1>
        <p class="lead">Bio-Feasibility • Agro-Economics • Quantum Distribution</p>
    </div>

    <div class="container mt-5">

        <ul class="nav nav-pills mb-4 justify-content-center" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-stage1-tab" data-bs-toggle="pill" data-bs-target="#stage1" type="button">
                    1. Feasibility (AI)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-stage2-tab" data-bs-toggle="pill" data-bs-target="#stage2" type="button" onclick="loadMarketChart()">
                    2. Market (LSTM)
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-stage3-tab" data-bs-toggle="pill" data-bs-target="#stage3" type="button">
                    3. Quantum Plan
                </button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">

            <div class="tab-pane fade show active" id="stage1">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card-custom p-4">
                            <h4><i class="fas fa-flask"></i> Soil & Climate Analysis</h4>
                            <p class="text-muted">Analyze soil samples and 3-month weather projection.</p>

                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label>District</label>
                                    <select class="form-select" id="locationSelect">
                                        <option value="Jenin">Jenin</option>
                                        <option value="Jericho">Jericho</option>
                                        <option value="Hebron">Hebron</option>
                                        <option value="Tulkarm">Tulkarm</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label>Soil Type</label>
                                    <select class="form-select" id="soilSelect">
                                        <option value="Loamy">Loamy (Balanced)</option>
                                        <option value="Clay">Clay (Heavy)</option>
                                        <option value="Sandy">Sandy (Light)</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label>pH Level: <span id="phVal" style="font-weight:bold; color:var(--primary);">6.5</span></label>
                                    <input type="range" class="form-range" min="4" max="9" step="0.1" id="phRange" oninput="document.getElementById('phVal').innerText=this.value">
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <button class="btn btn-success px-5 rounded-pill action-btn" onclick="runStage1()">Analyze Feasibility</button>
                            </div>

                            <hr>

                            <div id="stage1-results" style="display:none;">
                                <div id="weather-display" class="weather-badge text-center"></div>
                                <div id="crops-container" class="mt-3"></div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="stage2">
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="card-custom p-4 h-100">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4><i class="fas fa-chart-line"></i> 6-Month Market Projection</h4>
                                <button class="btn btn-sm btn-outline-primary" onclick="loadMarketChart()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="chart-container" style="height: 350px;">
                                <canvas id="marketChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 mb-4">
                        <div class="card-custom p-4 h-100" style="background-color: #f8f9fa; border-left: 5px solid var(--primary);">
                            <h5 class="text-success mb-3"><i class="fas fa-file-alt"></i> AI Market Report</h5>

                            <div class="mb-4">
                                <h6 class="text-muted text-uppercase small">Best Opportunity</h6>
                                <h2 class="fw-bold" id="report-best-month">--</h2>
                                <p class="text-muted small">Projected Peak Price</p>
                            </div>

                            <div class="mb-4">
                                <h6 class="text-muted text-uppercase small">Analysis</h6>
                                <p id="report-text" style="font-size: 0.95rem; color: #555;">
                                    Loading market analysis...
                                </p>
                            </div>

                            <div class="alert alert-warning mb-0">
                                <i class="fas fa-coins"></i> <strong>Financial Tip:</strong><br>
                                <span id="report-tip">--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="stage3">
                <div class="card-custom p-4 text-center">
                    <h4><i class="fas fa-project-diagram"></i> National Distribution Plan</h4>
                    <p>Optimizes crop allocation to prevent market surplus using Simulated Annealing.</p>

                    <button class="btn btn-dark px-5 rounded-pill action-btn" onclick="runStage3()">Run Quantum Solver</button>

                    <div id="stage3-results" class="mt-4 text-start" style="display:none;">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="alert alert-success h-100">
                                    <h5><i class="fas fa-check-circle"></i> Your Assignment</h5>
                                    <h1 class="display-4" id="assigned-crop" style="color: var(--primary); font-weight: bold;">--</h1>
                                    <p>AI Confidence: <span id="conf-score" class="badge bg-success">--</span></p>
                                </div>
                            </div>
                            <div class="col-md-7">
                                <h6><i class="fas fa-map"></i> National Heatmap</h6>
                                <div class="heatmap-grid" id="heatmap-grid">
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/script.js"></script>
</body>
</html>